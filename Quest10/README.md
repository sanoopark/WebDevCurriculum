# Quest 10. 인증의 이해

## Introduction

- 이번 퀘스트에서는 웹에서의 인증에 관해 알아보겠습니다.

## Topics

- Cookie
- Session
- JWT

## Resources

- [MDN - HTTP 쿠키](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)
- [Cookies and Sessions](https://web.stanford.edu/~ouster/cgi-bin/cs142-fall10/lecture.php?topic=cookie)
- [JWT](https://jwt.io/)

## Checklist

- 인증과 인가란 무엇일까요? (+)

  - 인증 : 권한이 주어진 사용자임을 아이디와 패스워드를 통해 확인하는 것 (로그인)
  - 인가 : 요청에 대해 사용자의 인증 여부를 보고 허가하는 것

- 쿠키란 무엇일까요?

  - 쿠키는 클라이언트 로컬에 저장되는 키와 값이 들어있는 작은 데이터 파일입니다.
  - 세션 인증에서는 세션 ID를 저장하고, 토큰 인증에서는 토큰을 저장하는 수단입니다.
  - 기타 개인화나 트래킹의 용도로도 사용합니다.

  - 쿠키는 어떤 식으로 동작하나요?
  - 쿠키는 어떤 식으로 서버와 클라이언트 사이에 정보를 주고받나요?

    - 클라이언트가 서버에 요청합니다.
    - 웹 서버는 쿠키를 생성합니다.
    - 생성한 쿠키에 정보를 담아 클라이언트에게 전달합니다.(Response Header의 `Set-Cookie` 속성)
    - 전달받은 쿠키는 클라이언트에 저장됩니다.
    - 이후 다시 서버에 요청할 때 요청과 쿠키를 함께 전달합니다. (Request Header의 `cookie` 속성)
    - 서버는 전달받은 쿠키를 이용하여 해당 요청을 처리하고 응답합니다.

- 웹 어플리케이션의 세션이란 무엇일까요?

  - 클라이언트로부터 서버에 전달된 요청이 동일한 사용자의 요청임을 서버에서 식별하기 위한 기술입니다.
  - 세션은 쿠키를 기반하고 있지만, 사용자 정보를 서버에서 관리하기 때문에 stateful입니다. (토큰은 클라이언트에서 관리하기 때문에 stateless)
  - 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지합니다.
  - 사용자 정보를 서버에 두기 때문에 사용자가 많아질수록 서버 메모리를 많이 차지하게 됩니다.
  - 동시접속이 많은 경우 서버에 과부하를 주므로 성능 저하의 요인이 됩니다.

- 세션의 ID와 내용은 각각 어디에 저장되고 어떻게 서버와 교환되나요?

  - 클라이언트가 서버에 요청 시 세션 ID를 발급받습니다.
  - 클라이언트는 세션 ID를 쿠키로 저장하고, 서버는 세션 ID에 대한 정보를 세션 DB에 저장합니다.
  - 클라이언트는 서버에 요청할 때, 세션 ID를 같이 서버에 전달해서 요청합니다.
  - 서버는 세션 ID로 세션 DB에 있는 사용자 정보를 가져와서 요청을 처리하고 응답합니다.

- JWT란 무엇인가요?

  - 클라이언트와 서버 간 통신 시 권한 인가를 위해 사용하는 토큰입니다.
  - 세션과 달리 서버가 시간에 따라 바뀌는 어떤 상태값을 갖지 않기 않기 때문에 stateless입니다.
  - 암호화된 게 아니기 때문에 누구나 내용을 볼 수 있습니다.
  - 2번 페이로드를 디코딩하면 JSON 형식으로 데이터(Claim)가 들어있습니다.
    (누가 누구에게 발급했는지, 언제까지 유효한지, 서비스가 사용자에게 토큰을 통해 공개하기를 원하는 내용(닉네임, 레벨, 관리자 여부 등))
  - 1번 헤더를 디코딩하면 type(JWT), alg(3번 서명 값을 만드는 데 필요한 알고리즘)
  - 서버에서는 1번 헤더 + 2번 페이로드 + 서버의 비밀키를 암호화 알고리즘에 넣고 돌려 3번 서명 값과 일치하는 결과가 나오는지 확인합니다.
  - 3번 서명값이 일치하고 유효기간도 지나지 않았다면 해당 사용자를 인가합니다.

  - JWT 토큰은 어디에 저장되고 어떻게 서버와 교환되나요?
    - 서버에서 받은 토큰을 브라우저의 쿠키, 스토리지에 저장합니다.
    - Request Header의 `authorization` 속성을 포함하는 요청을 만들어 교환합니다.

- 세션에 비해 JWT가 가지는 장점은 무엇인가요? 또 JWT에 비해 세션이 가지는 장점은 무엇인가요?

  - 세션 장점

    - 기억하는 대상의 상태들을 제어할 수 있기 때문에 특정 기능을 구현할 수 있습니다. (유저 강퇴, 디바이스 로그아웃, 계정 공유수 제한 등)

  - 세션 단점

    - stateful이기 때문에 구현하기 부담되고 고려사항이 많습니다.

  - JWT 장점

    - JWT를 사용하면 서버는 토큰의 유효성 여부만 알기 때문에 DB가 필요 없습니다. (QR 체크인도 JWT를 이용한 QR 코드)

  - JWT 단점

    - 토큰이 탈취된 경우 해당 토큰을 무효화할 방법이 없습니다. (실서비스 중에 JWT만으로 인가를 구현하는 곳은 그렇게 많지 않음)
    - 개선 : 만료시간을 가깝게 잡아서 accessToken의 수명을 짧게 하고 refreshToken을 통해 재발급하는 방법. accessToken이 아닌 refreshToken이 탈취되는 거라면 무효화 가능

## Quest

- 이번에는 메모장 시스템에 로그인 기능을 넣고자 합니다.
  - 사용자는 딱 세 명만 존재한다고 가정하고, 아이디와 비밀번호, 사용자의 닉네임은 하드코딩해도 무방합니다.
  - 로그인했을 때 해당 사용자가 이전에 작업했던 탭들과 마지막으로 활성화된 탭 등의 상태가 로딩 되어야 합니다.
  - 세션을 이용한 버전과, JWT를 이용한 버전 두 가지를 만들어 보세요!
    - 세션을 이용할 경우 세션은 서버의 메모리나 파일에 저장하면 됩니다.

## Advanced

- Web Authentication API(WebAuthn)은 무엇인가요?
